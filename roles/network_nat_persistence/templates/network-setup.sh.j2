#!/bin/bash
# Comprehensive Network Setup Script
# Auto-generated by Ansible - do not edit manually

LOG_FILE="/var/log/network-setup.log"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

echo "[$TIMESTAMP] Starting network setup" >> $LOG_FILE

# Apply network tuning
/etc/network/host-optimization/network-tuning.sh

# Apply firewall rules
/etc/network/host-optimization/firewall-rules.sh

# Apply NAT configuration
/etc/network/host-optimization/nat-config.sh

# Save iptables rules for persistence
iptables-save > /etc/iptables/rules.v4
ip6tables-save > /etc/iptables/rules.v6

echo "[$TIMESTAMP] Network setup completed successfully" >> $LOG_FILE

# Display current configuration
echo "[$TIMESTAMP] Current network configuration:" >> $LOG_FILE
echo "  Primary interface: {{ network_interfaces.primary }}" >> $LOG_FILE
echo "  Bridge interface: {{ network_interfaces.bridge }}" >> $LOG_FILE
echo "  VM network: {{ vm_network.subnet }}" >> $LOG_FILE
echo "  NAT rules count: $(iptables -t nat -L PREROUTING --line-numbers | wc -l)" >> $LOG_FILE
echo "  Forward rules count: $(iptables -L FORWARD --line-numbers | wc -l)" >> $LOG_FILE